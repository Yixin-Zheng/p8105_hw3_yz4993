p8105_hw3_yz4993
================
Yixin Zheng
2024-10-16

# Problem 1

This dataset contains 2595176 rows and 7 columns. Variables include
weather station id, date of observation, (tenths of mm), snowfall (mm),
snow depth (mm), and min and max temperature (tenths of degrees C).

Below we clean the data, creating separate variables for year, month,
and day and converting `tmax` and `tmin` to numeric. We find that 0 is
the most commonly observed value for snowfall. This is because most days
of the year, it does not snow at all in NY. The second most commonly
observed value is `NA`, indicating missingness. Other common values are
13, 25, and 51, suggesting that snowfall is originally recorded in
fractions of an inch and converted to mm.

``` r
ny_noaa %>% 
  count(snow) %>%
  arrange(desc(n))
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <int>   <int>
    ##  1     0 2008508
    ##  2    NA  381221
    ##  3    25   31022
    ##  4    13   23095
    ##  5    51   18274
    ##  6    76   10173
    ##  7     8    9962
    ##  8     5    9748
    ##  9    38    9197
    ## 10     3    8790
    ## # ℹ 272 more rows

``` r
ny_noaa = 
  ny_noaa %>% 
  separate(date, into = c("year", "month", "day"), convert = TRUE) %>% 
  mutate(
    tmax = as.numeric(tmax),
    tmin = as.numeric(tmin))
```

Below is a two-panel plot showing the average max temperature in January
and in July in each station across years. As expected, the mean
temperature in January is much lower than the mean temperature in July
for all stations and across all years. All stations appear to follow
similar trends of temperature peaks and valleys within a month across
the years, i.e. when one station has a high monthly mean temperature for
a given year, most other stations also have a high monthly mean
temperature for that year. We do see one uncharacteristically cold
station in July of 1987 or 1988, as well as a few other less drastic
outliers.

``` r
ny_noaa %>% 
  group_by(id, year, month) %>% 
  filter(month %in% c(1, 7)) %>% 
  summarize(mean_tmax = mean(tmax, na.rm = TRUE, color = id)) %>% 
  ggplot(aes(x = year, y = mean_tmax, group = id)) + geom_point() + geom_path() +
  facet_grid(~month) +
  labs(title = "Mean monthly temperature for each station across years for January and July")
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

<img src="p8105_hw3_yz4993_files/figure-gfm/1.2 plot avg tmax-1.png" width="90%" />

Below we show a two-panel plot including (i) a hex plot of `tmax` vs
`tmin` for the full dataset; and (ii) a ridge plot showing the
distribution of snowfall values (in mm) greater than 0 and less than 100
separately by year.

From the hex plot we see that while there is some variability, the
majority of the data cluster tightly in the center of the distribution.
In relatively rare cases, it seems that `tmax` is less than `tmin`,
which raises questions about data recording and quality.

From the ridge plot, we see a multimodal density of snowfall within a
given year. Most stations see between 0 and 35 mm of snow in a year.
Then there is a another group of stations that see about 45 mm of snow,
and another group that sees nearly 80 mm. It is likely this
multimodality stems from the conversion of measurements in one system
(fractions of an inch) to another (using the metric system), which was
also noted in the table of common values.

``` r
hex = 
  ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()

ridge = 
  ny_noaa %>% 
  filter(snow < 100, snow > 0) %>%
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges()

hex + ridge
```

    ## Picking joint bandwidth of 3.76

<img src="p8105_hw3_yz4993_files/figure-gfm/1.3 plot tmax vs tmin and snowfall-1.png" width="90%" />
\# Problem 2

Below, the table shows the number of men and women across three
education categories: “Less than high school,” “High school equivalent,”
and “More than high school.” Both gender are roughly equally distributed
in the “Less than high school” and “More than high school” categories,
while in “High school equivalent” category there are more men than
women.

``` r
gender_education_table <- merged_data %>%
  group_by(sex, education) %>%
  summarize(count = n_distinct(seqn)) %>%
  pivot_wider(
    names_from = education,
    values_from = count,
    names_prefix = "Education: "
  ) %>%
  knitr::kable()
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

``` r
gender_education_table
```

| sex | Education: Less than high school | Education: High school equivalent | Education: More than high school |
|:---|---:|---:|---:|
| Male | 28 | 36 | 56 |
| Female | 29 | 23 | 59 |

``` r
merged_data %>%
  filter(!is.na(education)) %>%
  ggplot(aes(x = age, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_grid(. ~ education) +
  scale_fill_manual(values = c("blue", "orange"), name = "Sex", labels = c("Male", "Female")) +
  labs(
    title = "Age Distribution by Education Category and Gender",
    x = "Age",
    y = "Density",
    caption = "Data from NHANES Study"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

<img src="p8105_hw3_yz4993_files/figure-gfm/2.2 reader-friendly table and visualization-1.png" width="90%" />
The age distribution plot below the table indicates that both male (in
blue) and female (in orange) follow a similar age pattern in the “More
than high school” category, with female peaking around age 30 (y-axis
represents density), and male peaking around 23-24. Both genders show a
decrease in density as age increases within this category. In the other
two categories, male and female exhibit different age patterns. In the
“Less than high school” category, male have the highest density around
ages 45-47, with the distribution being left-skewed. Despite a trough
around age 57, there are secondary peaks between ages 60-80. For female
in this category, the highest peak is around age 80, with the
distribution also being left-skewed, showing an increase in density as
age increases. In the “High school equivalent” category, female again
show a left-skewed distribution with a peak around age 80, while male
have a right-skewed distribution with a peak around age 21.

``` r
# aggregate across minutes to create a total activity variable for each participant
total_activity_data <- merged_data %>%
  group_by(seqn, sex, age, education) %>%
  summarize(total_activity = sum(activity, na.rm = TRUE)) %>%
  ungroup()
```

    ## `summarise()` has grouped output by 'seqn', 'sex', 'age'. You can override
    ## using the `.groups` argument.

``` r
total_activity_data %>%
  filter(!is.na(education)) %>%
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.5) +
  geom_smooth(method = "loess", se = FALSE) +
  facet_grid(. ~ education) +
  scale_color_manual(values = c("blue", "orange"), name = "Sex", labels = c("Male", "Female")) +
  labs(
    title = "Total Activity vs Age by Education Category and Gender",
    x = "Age",
    y = "Total Activity",
    caption = "Data from NHANES Study"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_yz4993_files/figure-gfm/2.3 aggregate and plot-1.png" width="90%" />
The 3-panel plot above shows total daily activity plotted against age,
with separate panels for different education levels. Generally, activity
levels decrease with age across all education categories for both
genders, but there are notable exceptions. In both the “High school
equivalent” and “More than high school” categories, females exhibit
slightly higher activity levels compared to males. In the “Less than
high school” category, females have higher activity levels than males
before age 50, but lower levels after age 50. Additionally, in the “High
school equivalent” category, females show significantly higher activity
levels than males around age 40.

``` r
# convert minute to hours
activity_timecourse_data <- merged_data %>%
  mutate(hour = minute / 60) %>%  # 
  group_by(hour, education, sex) %>%
  summarize(avg_activity = mean(activity, na.rm = TRUE)) %>%
  ungroup()
```

    ## `summarise()` has grouped output by 'hour', 'education'. You can override using
    ## the `.groups` argument.

``` r
activity_timecourse_data %>%
  filter(!is.na(education)) %>%
  ggplot(aes(x = hour, y = avg_activity, color = sex)) +
  geom_line() +  # Add the activity line
  geom_smooth(method = "loess", se = FALSE) +  # smooth trend lines
  facet_grid(. ~ education) +  #  by education
  scale_color_manual(values = c("blue", "orange"), name = "Sex", labels = c("Male", "Female")) +
  labs(
    title = "24-Hour Activity Time Course by Education Level and Sex with Smooth Trends",
    x = "Hour of the Day",
    y = "Average Activity",
    caption = "Data from NHANES Study"
  ) +
  scale_x_continuous(breaks = seq(0, 24, by = 2), labels = seq(0, 24, by = 2)) +  # set x-axis breaks at every 2 hours
  theme_minimal() +
  theme(legend.position = "bottom")
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_yz4993_files/figure-gfm/2.4 3-panel plot-1.png" width="90%" />
The plot above also reflects similar observations to the previous one,
with males and females having comparable average activity levels by the
hour in the “Less than high school” category, while females exhibit
noticeble higher average activity levels than males in the other two
categories. It is notable that, across all education levels, both men
and women follow similar hourly activity patterns—activity slowly
increase from 00:00 to 10:00, peaks around 10:00- 13:00, then a steady
decline after.
