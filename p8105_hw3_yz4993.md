p8105_hw3_yz4993
================
Yixin Zheng
2024-10-16

# Problem 1

Below we import and clean data from `p8105_datasets`. This `ny_noaa`
data include daily weather observations at New York state weather
stations gathered by the NOAA National Climatic Data Center. It is a
tibble that contains a total of 2595176 observations and 7 variables,
which are:

**id**: (chr) A character column representing the weather station ID.
For example: “US1NYAB0001”.

**date**: (Date) A Date column representing the date of the observation.
The format is “YYYY-MM-DD”.

**prcp**: (int) An integer column representing precipitation in tenths
of millimeters. Many of the entries are missing (NA).

**snow**: (int) An integer column representing snowfall in millimeters,
with many missing (NA) values.

**snwd**: (int) An integer column representing snow depth in
millimeters, also with many missing (NA) values.

**tmax**: (chr) A character column representing maximum temperature in
tenths of degrees Celsius, where values are often missing (NA).

**tmin**: (chr) A character column representing minimum temperature in
tenths of degrees Celsius, where values are often missing (NA).

As noted, there is substantial missing data, especially for temperature
and snowfall variables. This is common in weather datasets due to
varying reporting practices across stations and time periods. However,
missing data may not pose a significant issue if the analysis is focused
on a particular time range or specific variables with more complete
records. It’s important to assess missing data patterns to ensure they
don’t introduce bias or affect the validity of the analysis.

``` r
# data cleaning: create separate variables for year, month, and day + convert units
ny_noaa <- ny_noaa %>%
  mutate(
    year = year(date),
    month = month(date),
    day = day(date),
    prcp = prcp / 10,   # from tenths of millimeters to mm
    tmax = as.numeric(tmax) / 10,  # from character to numeric(degrees C)
    tmin = as.numeric(tmin) / 10   # from character to numeric(degrees C)
  )

# most common snowfall values
snow_group <- ny_noaa %>%
  group_by(snow) %>%
  summarize(n_obs = n()) %>%
  arrange(desc(n_obs))

# the most common snowfall values
snow_group %>% head
```

    ## # A tibble: 6 × 2
    ##    snow   n_obs
    ##   <int>   <int>
    ## 1     0 2008508
    ## 2    NA  381221
    ## 3    25   31022
    ## 4    13   23095
    ## 5    51   18274
    ## 6    76   10173

After data cleaning, the new `ny_noaa` dataset now has 10 variables
because we created separate columns for `year`, `month`, and `day`. All
variables have been converted to appropriate units. For example, `tmax`
and `tmin` have been converted from character to numeric values, and now
represent temperatures in degrees Celsius (instead of tenths of degrees
Celsius). Similarly, `prcp` has been converted from tenths of
millimeters to millimeters to align with the units of `snow` and `snwd`,
which are already in millimeters. The most commonly observed value for
snowfall is 0 mm, which appears 2,008,508 times in the dataset. This
high frequency of 0 snowfall is expected because new york is humid
continental climate, which means snowfall is typically limited to the
winter months, while much of the year do not record any snow.

``` r
# filter for temperature in January and in July
temps_jan_jul <- ny_noaa %>%
  filter(month %in% c(1, 7)) %>%
  group_by(id, year, month) %>%
  summarize(avg_tmax = mean(tmax, na.rm = TRUE), .groups = "drop")


# plot average max temperature in January and July
ggplot(temps_jan_jul, aes(x = year, y = avg_tmax, color = factor(month))) +
  geom_line(size = 1) +   # better visibility
  scale_color_viridis_d(name = "Month", labels = c("January", "July")) + 
  labs(
    title = "Average Maximum Temperature in January and July",
    x = "Year",
    y = "Average Max Temperature (°C)",
    caption = "Data from NOAA National Climatic Data Center"
  ) +
  scale_x_continuous(breaks = seq(1980, 2010, by = 5), labels = seq(1980, 2010, by = 5)) +  # set breaks
  scale_y_continuous(labels = scales::number_format(suffix = "°C")) +  # degree symbol
  theme_minimal() +   # minimal theme
  facet_wrap(~ factor(month), labeller = as_labeller(c(`1` = "January", `7` = "July"))) # facet by month
```

    ## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
    ## ℹ Please use `linewidth` instead.
    ## This warning is displayed once every 8 hours.
    ## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
    ## generated.

![](p8105_hw3_yz4993_files/figure-gfm/1.2%20plot%20avg%20tmax-1.png)<!-- -->

We have now created a two-panel plot using facet_wrap to split by month
(January and July). As expected, January temperatures are much lower
than July, with more pronounced variability in winter. January shows a
few colder-than-usual years, particularly around 1990, indicating
stronger cold spells. July, on the other hand, remains more stable, with
only slight dips in certain years like the mid-1990s and early 2000s.
Overall, the trends are consistent across years, with no extreme
outliers or significant long-term temperature shifts observed.

``` r
hex = 
  ny_noaa %>% 
  ggplot(aes(x = tmin, y = tmax)) + 
  geom_hex()

snowfall_dist = 
  ny_noaa %>% 
  filter(snow < 100, snow > 0) %>%
  ggplot(aes(x = snow, y = as.factor(year))) + 
  geom_density_ridges()

hex + snowfall_dist
```

    ## Warning: Removed 1136276 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

    ## Picking joint bandwidth of 3.76

![](p8105_hw3_yz4993_files/figure-gfm/1.3%20plot%20tmax%20vs%20tmin%20and%20snowfall-1.png)<!-- -->

Here is a two-panel plot including (i) a hex plot of tmax vs tmin for
the full dataset, and (ii) a distribution plot showing snowfall values
(in mm) greater than 0 and less than 100 separately by year. From the
hex plot, we observe that most data points cluster along the diagonal,
indicating a strong correlation between tmax and tmin. However, there
are a few instances where tmax is lower than tmin, which suggests
potential data recording errors or inconsistencies. The snowfall
distribution plot shows a clear peak around 0 to 20 mm across most
years, with some years having more significant snowfall values around 40
to 80 mm. This indicates variability in snowfall between different
regions and years, possibly influenced by local weather conditions or
measurement systems.
